<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;margin:0;background:#f3f3f3;}
header{background:#0d6efd;color:#fff;padding:15px;font-size:20px;text-align:center;}
.container{padding:15px;}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:8px;box-shadow:0 0 5px #ccc;}
input,select,button{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:1px solid #ccc;}
button{background:#0d6efd;color:#fff;border:none;font-weight:bold;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ccc;padding:8px;text-align:left;}
th{background:#e9ecef;}
.role-tag{padding:2px 6px;border-radius:4px;font-size:12px;}
.staff{background:#d1e7dd;color:#0f5132;}
.supervisor{background:#cff4fc;color:#055160;}
.security{background:#fde2e4;color:#b02a37;}
.shift-box{padding:5px;background:#f8f9fa;border:1px solid #ddd;border-radius:5px;margin-top:5px;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-top:10px;}
.day{background:#fff;border:1px solid #ddd;padding:10px;height:80px;cursor:pointer;border-radius:5px;font-size:12px;}
.day.assigned{background:#dbeafe;}
</style>
</head>
<body>
<header>Fingerprint Attendance & Shift Manager</header>

<div class="container">

<div class="card">
<h3>Register Staff</h3>
<input id="name" placeholder="Full Name">
<select id="role">
<option value="staff">Staff</option>
<option value="supervisor">Supervisor</option>
<option value="security">Security</option>
</select>
<button onclick="addUser()">Add User</button>
</div>

<div class="card">
<h3>Registered Users</h3>
<table id="usersTable">
<tr><th>Name</th><th>Role</th></tr>
</table>
</div>

<div class="card">
<h3>Mark Attendance (Fingerprint)</h3>
<select id="attUser"></select>
<button onclick="markAttendance()">Scan Fingerprint</button>

<table id="attendanceTable">
<tr><th>Name</th><th>Role</th><th>Date</th><th>Time</th></tr>
</table>
</div>

<div class="card">
<h3>Shift Manager</h3>
<p>Select a user and assign days on the calendar.</p>
<select id="shiftUser"></select>
<div id="calendar" class="calendar-grid"></div>
<h4>Assigned Shifts</h4>
<div id="shiftList"></div>
</div>

</div>

<script>
let users = JSON.parse(localStorage.getItem("users")||"[]");
let attendance = JSON.parse(localStorage.getItem("attendance")||"[]");
let shifts = JSON.parse(localStorage.getItem("shifts")||"{}");

function save(){localStorage.setItem("users",JSON.stringify(users));
localStorage.setItem("attendance",JSON.stringify(attendance));
localStorage.setItem("shifts",JSON.stringify(shifts));}

function renderUsers(){
let t=document.getElementById("usersTable");
t.innerHTML="<tr><th>Name</th><th>Role</th></tr>";
users.forEach(u=>{
t.innerHTML+=`<tr><td>${u.name}</td><td><span class="role-tag ${u.role}">${u.role}</span></td></tr>`;
});
document.getElementById("attUser").innerHTML = 
users.map(u=>`<option>${u.name}</option>`).join("");
document.getElementById("shiftUser").innerHTML = 
users.map(u=>`<option>${u.name}</option>`).join("");
}
renderUsers();

function addUser(){
let n=document.getElementById("name").value.trim();
let r=document.getElementById("role").value;
if(!n)return alert("Enter name");
users.push({name:n,role:r});
save();renderUsers();document.getElementById("name").value="";
}

function markAttendance(){
let n=document.getElementById("attUser").value;
let u=users.find(x=>x.name===n);
let now=new Date();
attendance.push({
name:n,role:u.role,
date:now.toDateString(),
time:now.toLocaleTimeString()
});
save();renderAttendance();
}

function renderAttendance(){
let t=document.getElementById("attendanceTable");
t.innerHTML=`<tr><th>Name</th><th>Role</th><th>Date</th><th>Time</th></tr>`;
attendance.forEach(a=>{
t.innerHTML+=`
<tr><td>${a.name}</td><td><span class="role-tag ${a.role}">${a.role}</span></td>
<td>${a.date}</td><td>${a.time}</td></tr>`;
});
}
renderAttendance();

// ----- CALENDAR -----
function buildCalendar(){
let c=document.getElementById("calendar");
c.innerHTML="";
let days=30;
for(let i=1;i<=days;i++){
let d=document.createElement("div");
d.className="day";
d.innerHTML=i;
d.onclick=()=>assignShift(i);
c.appendChild(d);
}
}
buildCalendar();
function assignShift(day){
let sel=document.getElementById("shiftUser").value;
if(!sel)return alert("Select a user");
if(!shifts[sel])shifts[sel]=[];
if(shifts[sel].includes(day)){
shifts[sel]=shifts[sel].filter(d=>d!==day);
}else{
shifts[sel].push(day);
}
save();renderShifts();
renderCalendarHighlight();
}

function renderShifts(){
let div=document.getElementById("shiftList");
div.innerHTML="";
for(let u in shifts){
div.innerHTML+=`<div><b>${u}</b>: ${shifts[u].join(", ")}</div>`;
}
}

function renderCalendarHighlight(){
let sel=document.getElementById("shiftUser").value;
document.querySelectorAll("#calendar .day").forEach(d=>{
let day=parseInt(d.innerHTML);
if(shifts[sel]&&shifts[sel].includes(day)){
d.classList.add("assigned");
}else{
d.classList.remove("assigned");
}
});
}

document.getElementById("shiftUser").addEventListener("change",()=>{
renderCalendarHighlight();
renderShifts();
});

// ----- INITIAL RENDER -----
renderShifts();
renderCalendarHighlight();

// ----- EXPORT ATTENDANCE TO PDF -----
function downloadAttendancePDF(){
let s = window.open('','_blank');
s.document.write("<html><head><title>Attendance</title></head><body>");
s.document.write("<h2>Attendance Records</h2>");
s.document.write("<table border='1'><tr><th>Name</th><th>Role</th><th>Date</th><th>Time</th></tr>");
attendance.forEach(a=>{
s.document.write(`<tr><td>${a.name}</td><td>${a.role}</td><td>${a.date}</td><td>${a.time}</td></tr>`);
});
s.document.write("</table></body></html>");
s.document.close();
s.print();
}

// Add button dynamically
let btn=document.createElement("button");
btn.textContent="Download Attendance PDF";
btn.style.margin="10px 0";
btn.onclick=downloadAttendancePDF;
document.body.insertBefore(btn,document.body.firstChild);
</script>
</body>
</html>